---
title: "Primeros pasos en pRoductivizaci√≥n"
subtitle: "\" Qu√© podemos hacer con R\""
author: "Ca√±adas Reche, Jos√© Luis"
class: "Grado en ciencia e ingenier√≠a de datos"
institute: "Escuela polit√©cnica de ingenier√≠a de Gij√≥n"
date: "2023-10-23"
date-format: iso
format:
  revealjs: 
    slide-number: true
    theme: theme.scss
    css: theme.css
    linkcolor: "#1a1a1a"
    highlight-style: github
    code-copy: true
    code-link: true
    code-overflow: wrap
    code-block-bg: true
    transition: fade
    width: 1600
editor: source
title-slide-attributes: 
  data-background-image: "images/esferas.jpeg"
  data-background-size: "45%"
  data-background-position: "right"
---

## [Sobre mi]{style="color: #000000;"} {.dark background-color="#333333"}

<br>

::: columns
::: {.column width="40%"}
![](images/profile2.jpg){#headshot height="500px"}
:::

::: {.column width="60%"}
-   Soy Jos√© Luis Ca√±adas Reche üëã
-   Data Scientist/ Estad√≠stico üíª
-   Ô∏èOrange Spain üçä
:::
:::

## <span style="color: #ffffff;">Qu√© quiero contar {.light background-color="#ffffff"}

::: incremental

<br>

-   ¬øQu√© es esto de poner en "producci√≥n" los modelos? 

-   Depende de d√≥nde estemos trabajando

-   ¬øSe puede con R? ¬øCon qu√© herramientas? 

-   ¬øC√≥mo es en una gran empresa? 
:::

##  {.trans background-color="#ffffff" background-image="images/trans1.png" background-size="65%"}

<h1>

<center>[¬øPoner modelos en producci√≥n?<br> ¬øy por qu√©?]{style="color: #ffffff;"}</center>

</h1>


## <span style="color: #ffffff;">¬øProductivizar ? ¬øy por qu√©? {.light background-color="#ffffff"}

**Productivizar**: No existe la palabra en castellano

<br>

::: fragment
Hablando de modelos podr√≠a ser cosas como:
:::

::: incremental
-   El modelo es capaz de generar una salida dada una entrada. 
-   Realiza el paso anterior sin intervenci√≥n humana/manual
-   Se integra con la infraestructura de la empresa
-   El modelo est√° versionado de alguna forma
-   El software utilizado est√° "congelado" y se puede portar a otra m√°quina
:::



## [D√≥nde estamos trabajando. Ejemplos]{style="color: #000000;"} {.dark background-color="#333333"}

::: columns
::: {.column width="50%"}

<br>

::: {.incremental}

- Soy freelance. Un cliente ejecutar modelo una vez al mes

- Trabajo en Cabify. Dar precio viaje de forma muy r√°pida

- Trabajo en Orange. Scores diarios sobre 4 millones de l√≠neas

:::
:::

::: {.column width="50%"}
<br>

::: {.incremental}

- Freelance: Una API, una ejecuci√≥n programada con un crontab. 

- Cabify:  Una API que responda r√°pido, quiz√° dockerizada y en Kubernetes. Gesti√≥n de concurrencia

- Orange: Predicci√≥n en batch por las noches. Gesti√≥n de errores, planes de rollback.

:::
:::
:::



## <span style="color: #ffffff;">¬øQu√© podemos hacer con R? {.light background-color="#ffffff"}

::: {.incremental}

- Prototipar el modelo
- Creaci√≥n de la API 
- Dockerizar la API de forma que sea portable
- Interactuar desde R con otras herramientas m√°s apropiadas para predicci√≥n en batch

:::

## <span style="color: #ffffff;">Herramientas y otras cosas en R {.light background-color="#ffffff"}

::: {.incremental}

- [`renv`](https://rstudio.github.io/renv/articles/renv.html)
- [`vetiver`](https://vetiver.rstudio.com/)
- [`plumber`](https://www.rplumber.io/)
- [`rocker`](https://hub.docker.com/u/rocker)
- [`r-hub/r-minimal`](https://github.com/r-hub/r-minimal)
- [Wrapper con cosas como h2o](https://h2o.ai/resources/download/)

:::

## <span style="color: #ffffff;"> renv {.light background-color="#ffffff"}

::: {.incremental}

- Entornos a lo _python_ 
- `renv.lock` fichero d√≥nde se especifican dependencias
- `renv` puede usar cache y ahorrar espacio. A diferencia de los conda-env
- Aislar el entorno
:::


## <span style="color: #ffffff;"> vetiver {.light background-color="#ffffff"}

::: {.incremental}

- MLOps para `R` y `Python`
- En R se integra bien con `tidymodels`
- En python con sklearn
- Facilita creaci√≥n de apis con plumber en `R` y fastapi en `python`
- Crear Dockerfile
- Versionar modelos, uso de `pins`

:::


## <span style="color: #ffffff;"> rocker y r-hub/minimal {.light background-color="#ffffff"}

::: {.incremental}

- Im√°genes de docker
- Rocker. Imagen  ubuntu + R. 
  - M√°s f√°cil de configurar
  - Se instala m√°s r√°pido
  - La imagen final de docker ocupa bastante. >2Gb
- r-hub/r-minimal. 
  - Imagen Alpine-linux liviana
  - Tarda m√°s en instalar librer√≠as
  - Instala librer√≠as de R sin la ayuda ni vi√±etas
  - La imagen final de docker es peque√±a. < 700 Mb

:::

## <span style="color: #ffffff;"> H2O {.light background-color="#ffffff"}

::: {.incremental}

- Escrito en java
- Wrapper para R y Python
- Gesti√≥n muy eficiente de la memoria
- Puede usarse en clusters de BigData con sparkling-water
- Se puede poner en producci√≥n de la misma forma que cualquier c√≥digo de spark
- Para predicci√≥n en batch para datasets muy grande es imbatible

:::

##  {.transdark background-color="#333333" background-image="images/whybis.jpg" background-size="65%"}

<h1>

<center>[¬° A la demo !]{style="color: #000000;"}</center>

</h1>



## <span style="color: #ffffff;"> ¬øY ahora qu√©? {.light background-color="#ffffff"}

Hora de los sysadmin, arquitectos (datos, cloud, sistemas). ¬°Ojo, no es f√°cil!

::: {.incremental}

- Desplegar docker en servidor interno
- Usar docker compose o kubernetes en sistemas internos
- Desplegar en la nube. 
  - Azure . [AzureContainer package](https://github.com/Azure/AzureContainers)


:::


## <span style="color: #ffffff;"> Algunos enlaces {.light background-color="#ffffff"}

<br>

* [R in production](https://posit.co/blog/using-r-in-production-with-posit-connect/?li_fat_id=0e3a3769-1643-4513-acc9-f1813833b3fb)

* [plumber + promises](https://rstudio.github.io/promises/articles/promises_05_future_promise.html)

* [plumber + kubernetes](https://mdneuzerling.com/post/hosting-a-plumber-api-with-kubernetes/)

* [plumber + kubernetes djnavarro](https://blog.djnavarro.net/posts/2023-01-10_kubernetes/#expose-an-api)

* [Alternativa a plumber `RestRserve`](https://restrserve.org/)


